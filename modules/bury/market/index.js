/*!
 * wkapi.js 1.2.2
 * (c) 2018-2020 wakedata
 * Released under the MIT License.
 */
let e = "wk.20181119.uid", t = "wk.20181119.opr", n = "onShow", r = "onHide", o = "onError", a = "onLaunch", i = { BOOT: "boot", ERROR: "error", APP_HIDE: "app_hide", APP_SHOW: "app_show", LEAVE_PAGE: "page_leave", PAGE_ON_SHOW: "page_onshow", SET_UID: "set_uid", CHANGE_UID: "change_uid", USER: "user_message", AUTH: "user_auth", CLICK: "click", LOCATION: "user_location_message" }, s = { system: "system", normal: "norm", event: "event" }, c = { appId: "", appKey: "", uuid: "", opid: "", global: {}, tzone: function () { let e = -(new Date).getTimezoneOffset(); if ("0" != e && "" !== e && null !== e) { let t = Math.abs(e), n = (Math.floor(t / 60).toString().length < 2 ? "0" + Math.floor(t / 60).toString() : Math.floor(t / 60).toString()) + ":" + ((t % 60).toString().length < 2 ? "0" + (t % 60).toString() : (t % 60).toString()), r = e > 0 ? "+" : "-"; return r + n } return "" }() }, u = { is_first_day: !1, is_first_time: !1 }; function p() { } let l = { Page: Page, App: App, Component: Component, getCurrentPages: getCurrentPages }, f = wx || { getNetworkType: p, getSystemInfoSync: p, setStorageSync: p, getStorageSync: p, request: p }; function g(e) { let t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "YYYY-MM-DD"; if (!e) return ""; "[object Number]" === Object.prototype.toString.call(e) && 10 === (e + "").length && (e *= 1e3), "[object Date]" === !Object.prototype.toString.call(e) && (e = new Date(e)); let n = e.getFullYear(), r = e.getMonth(), o = e.getDate(), a = e.getHours(), i = a % 12 == 0 ? 12 : a % 12, s = e.getMinutes(), c = e.getSeconds(), u = e.getMilliseconds(), p = function (e) { return ("0" + e).slice(-2) }, l = { YYYY: n, MM: p(r + 1), M: r + 1, DD: p(o), D: o, HH: p(a), H: a, hh: p(i), h: i, mm: p(s), m: s, ss: p(c), s: c, S: u }; return t.replace(/Y+|M+|D+|H+|h+|m+|s+|S+/g, function (e) { return l[e] }) } let _, d = ((_ = function () { }).setURL_UUID = function (e) { e && (_.URL_UUID = e) }, _.setURL_REPORT_REAL_TIME = function (e) { e && (_.URL_REPORT_REAL_TIME = e) }, _.setSource = function (e) { e && (_.source = e) }, _.URL_UUID = "https://stream.wakedata.com/dmp/api/report/uuid", _.URL_REPORT_REAL_TIME = "https://stream.wakedata.com/dmp/api/report/realtime", _.source = "", _); let m = { enable: !1, url: "https://www.wakedata.com/athena/wxappbadreport/recevie" }, v = { UUID: "uuid", BOOT: "boot", APP_ERROR: "apperror" }; function h(e, t) { (m.enable || e === v.APP_ERROR) && f.request({ url: m.url + "?scene=" + e + "&opt=" + encodeURIComponent(JSON.stringify(t)) }) } let y = {}; function b() { let e = l.getCurrentPages(); if (e && 0 !== e.length) { let t = ""; try { t = e && e[e.length - 1] && e[e.length - 1].route } catch (e) { } if (t === y.ru) return y; let n = { ru: t, lastru: y.ru }; return y = Object.assign({}, n), n } return { ru: "", lastru: "" } } let R = Object.assign || function (e) { for (let t = 1; t < arguments.length; t++) { let n = arguments[t]; for (let r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r]) } return e }, S = [], w = { get: function (e) { try { return f.getStorageSync(e) } catch (e) { } }, set: function (e, t) { try { f.setStorageSync(e, t) } catch (e) { } } }, O = { test_flag: 0, ableReport: !1, apiUidLossTime: 0, appId: null, launch: { sourceappid: "", scene: "" }, global: R({ opid: c.opid, mid: c.uuid, appKey: c.appKey, tzone: c.tzone, device: null, sdk: { version: "1.2.0", type: "wx-app" } }, c.global) }; function U() { S.length > 0 && I.run < I.max && (I.run += 1, function (e) { let t = e.config; !t.bzparm && C && (t.bzparm = C); t.global = O.global, (e.getCategory() === i.BOOT || e.getCategory() === i.USER) && (t.sourceappid = O.launch.sourceappid, t.scene = O.launch.scene); O.test_flag && (t.test_flag = 1); let n = d.URL_REPORT_REAL_TIME + "?appId=" + O.appId + "&ts=" + +new Date + "&content=" + encodeURIComponent(JSON.stringify(t)); d.source && (n = n + "&source=" + d.source); f.request({ url: n, success: U, fail: (r = t.event, function () { "boot" === r && h(v.BOOT, { uuid: O.global.mid }) }), complete: E }); let r }(S.splice(0, 1)[0])) } let I = { run: 0, max: 2 }; function E() { I.run -= 1 } function L(e) { A(new D(s.system, { event: i.BOOT, parm: {} })); try { e && e.referrerInfo && e.referrerInfo.appId && (O.launch.sourceappid = e.referrerInfo.appId), e && e.scene && (O.launch.scene = e.scene) } catch (e) { } let n = w.get(t); n ? (n -= 0, n += 1) : n = 1e3, w.set(t, n), O.global.opid = n, I.start = +new Date, T() } function P() { let t, n, r, o = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, a = o.appId, i = o.appKey, s = o.URL_UUID, c = o.URL_REPORT, p = o.test_flag, l = o.source, _ = void 0 === l ? "action_report_topic" : l; return a ? i ? (O.appId = a, O.global.appKey = i, s && d.setURL_UUID(s), c && d.setURL_REPORT_REAL_TIME(c), _ && d.setSource(_), p && (O.test_flag = 1), function () { f.getStorageSync("wk_bury_is_not_first_time") || (f.setStorageSync("wk_bury_is_not_first_time", !0), u.is_first_time = !0); let e = new Date, t = f.getStorageSync("wk_bury_first_time_stamp"); t ? g(e) === g(t) && (u.is_first_day = !0) : (f.setStorageSync("wk_bury_is_not_first_time", e), u.is_first_day = !0) }(), function (t) { let n = w.get(e); if (n) return O.global.mid = n, t(); !function n() { O.apiUidLossTime > 3 || (O.apiUidLossTime += 1, f.request({ url: d.URL_UUID, success: function (r) { let o = r.data ? r.data.data : ""; o ? (w.set(e, O.global.mid = o), t()) : n() }, fail: function (e) { h(v.UUID, { time: O.apiUidLossTime }), n() } })) }() }(function () { T() }), t = function (e) { O.global.device = e, T() }, n = {}, (r = f.getSystemInfoSync()) && function (e, t) { t.dp = e.screenWidth + "x" + e.screenHeight, t.model = e.model, t.wxver = e.SDKVersion, t.language = e.language, t.brand = e.brand, t.platform = e.platform; let n = e.system; t.os_ver = n; let r = n.split(" "); r && r.length && (t.os = r[0]) }(r, n), void f.getNetworkType({ success: function (e) { e && e.networkType && (n.nt = e.networkType) }, complete: function () { t(n) } })) : console.warn("\u57cb\u70b9\u521d\u59cb\u5316\u5931\u8d25\uff0c\u7f3a\u5c11appKey") : console.warn("\u57cb\u70b9\u521d\u59cb\u5316\u5931\u8d25\uff0c\u7f3a\u5c11appId") } function A(e) { setTimeout(function () { S.push(e), O.ableReport ? U() : T() }, 0) } function T() { let e = b(); e.ru && O.appId && O.global.opid && O.global.mid && O.global.device && C && (S.forEach(function (t) { t.config.page_info && t.config.page_info.ru || (t.config.page_info = e) }), U(), O.ableReport = !0) } function D(e, t) { this.category = e, t.event_type = e, t.optime = +new Date, t.page_info = b(), C && (t.bzparm = C), t.is_first_day = u.is_first_day, t.is_first_time = u.is_first_time, this.config = t } D.prototype.getCategory = function () { return this.category === s.system || this.category === s.normal ? this.config.event : "" }; let C = null; let k = Object.assign || function (e) { for (let t = 1; t < arguments.length; t++) { let n = arguments[t]; for (let r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r]) } return e }, H = { heatBeatStart: !1, time: 0, ru: "", lastru: "" }; function M(e) { !function (e) { A(new D(s.system, { event: i.LEAVE_PAGE, parm: k({ stay_dur: +new Date - H.time }, e || {}) })) }(e) } let x = Object.assign || function (e) { for (let t = 1; t < arguments.length; t++) { let n = arguments[t]; for (let r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r]) } return e }; function B(e, t) { A(new D(e, t)) } function K(e, t, n) { let r = void 0; if (e && t && (r = e(n))) return x({}, r, { pageKey: t }) } let j = "ftBuryLoadArgument", N = "ftBuryPageKey", Y = function (e) { let t = this[j], n = this[N]; if (!!t && !!n) { let r = K(t, n, e); r ? this._buryLoadArg = r : this.__cache_bury_load_msg = e } }, z = function (e) { B(s.system, { event: i.ERROR, parm: { msg: e } }) }, G = function () { H.time = +new Date, B(s.system, { event: i.PAGE_ON_SHOW, parm: {} }) }, W = function () { let e = this._buryLoadArg; this.__cache_bury_load_msg && (e = K(this[j], this[N], this.__cache_bury_load_msg)), M(e) }, q = function (e) { console.log("burySdk:AppLife:hide", e), B(s.system, { event: i.APP_HIDE, parm: {} }) }, J = function () { console.log("burySdk:AppLife:show"), B(s.system, { event: i.APP_SHOW, parm: {} }) }, V = { wkBuz: function (e, t) { B(s.event, { event: e, parm: t }) }, wkClick: function (e) { B(s.normal, { event: i.CLICK, parm: { x: e.detail.x, y: e.detail.y } }) }, wkReport: function (e, t, n) { B(s.normal, { event: i.CLICK, parm: { x: n.detail.x, y: n.detail.y, key: e, value: t } }) }, wkHotCatch: function (e) { B(s.normal, { event: i.CLICK, parm: { x: e.detail.x, y: e.detail.y } }) } }; function F(e, t, n) { let r = e[t]; e[t] = function () { for (let e = arguments.length, t = Array(e), o = 0; o < e; o++)t[o] = arguments[o]; n.call.apply(n, [this].concat(t)), r && r.call.apply(r, [this].concat(t)) } } let Q = App; App = function (e) { F(e, o, z), F(e, a, L), F(e, n, J), F(e, r, q), Q.call(this, e) }; let X = Page; Page = function (e) { for (let t in V) e[t] = V[t]; F(e, "onLoad", Y), F(e, "onShow", G), F(e, "onHide", W), F(e, "onUnload", W), X.call(this, e) }; let Z = Component; Component = function (e) { for (let t in e.methods || (e.methods = {}), V) e.methods[t] = V[t]; Z.call(this, e) }; export default { updateRunTimeBzParam: function (e) { C = R({}, C || {}, e), T() }, badJs: { BAD_SCENE: v, openBadReport: function () { m.enable = !0 }, reportBad: h }, config: function (e) { P(e) }, currentPageInfo: b, report: function (e) { let t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; e ? B(s.event, { event: e, parm: t }) : console.warn("\u8bf7\u8f93\u5165\u4e8b\u4ef6\u540d") }, reportUser: function () { let e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}; !function (e) { let t = {}; for (let n in e) t[n] = e[n]; O.global.user = t }(e), B(s.normal, { event: i.USER, parm: { user: e, user_profile: t } }) }, reportAuthOperation: function () { let e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0], t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0; B(s.normal, { event: i.AUTH, parm: { result: e ? 1 : 0, author_type: t } }) }, reportLocation: function () { let e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}; B(s.normal, { event: i.LOCATION, parm: e }) } };